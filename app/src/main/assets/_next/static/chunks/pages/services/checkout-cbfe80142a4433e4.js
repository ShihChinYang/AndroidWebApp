(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2037],{87443:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/services/checkout",function(){return t(30955)}])},18884:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var s=t(85893),a=t(67294),r=t(9473),i=t(2859),o=t(28714);function c(e){let{setStripePromise:n}=e,t=(0,r.v9)(e=>e.auth.stripePublishableKey);return(0,a.useEffect)(()=>{t&&((0,o.qu)(!1,"stripePublishableKey"),n((0,i.J)(t)))},[t]),(0,s.jsx)("p",{hidden:!0,children:"Load Stripe"})}},30955:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return w}});var s=t(85893),a=t(67294),r=t(9473),i=t(11163),o=t(33353),c=t(68888),l=t(88083),u=t(86664),p=t(81011),d=t(18884);function f(){let e=(0,u.useStripe)(),n=(0,u.useElements)(),[t,r]=(0,a.useState)(null),[i,o]=(0,a.useState)(!1),c=async t=>{if(t.preventDefault(),!e||!n)return;o(!0);let{error:s}=await e.confirmPayment({elements:n,confirmParams:{return_url:"".concat(window.location.origin,"/services/paymentCompletion")}});"card_error"===s.type||"validation_error"===s.type?r(s.message):r("An unexpected error occured."),o(!1)};return(0,s.jsxs)("form",{id:"payment-form",onSubmit:c,children:[!1,(0,s.jsx)(u.PaymentElement,{id:"payment-element"}),(0,s.jsx)("button",{disabled:i||!e||!n,id:"submit",children:(0,s.jsx)("span",{id:"button-text",children:i?(0,s.jsx)("div",{className:"spinner",id:"spinner"}):"Submit"})}),t&&(0,s.jsx)("div",{id:"payment-message",children:t})]})}var g=t(71601),m=t(37383),h=t(28714);function w(){let e=(0,i.useRouter)(),n=(0,r.I0)(),[t,w]=(0,a.useState)(null),[b,x]=(0,a.useState)(null),[S,v]=(0,a.useState)(null),[j,k]=(0,a.useState)(!1),y=(0,r.v9)(e=>e.auth.isLoggedIn),E=(0,r.v9)(e=>e.auth.memberId),A=(0,r.v9)(e=>e.account.stripeClientSecret),I=(0,r.v9)(e=>e.account.appleClientSecret),P=(0,r.v9)(e=>e.account.checkoutItem),_=(0,r.v9)(e=>e.account.invoice),N=(0,r.v9)(e=>e.account.checkoutPlan),T=_&&_.planOptions,C=T&&T[N].planId;(0,h.qu)(!0,"isLoggedIn: ".concat(y,", checkoutPlan: ").concat(N));let H=e=>{(0,h.qu)(!0,"savePendingAppleTransaction - "),x(e);let n=localStorage.getItem("pendingAppleTransactions");(n=n?JSON.parse(n):{})[E]=e,n=JSON.stringify(n),localStorage.setItem("pendingAppleTransactions",n)},q=()=>{(0,h.qu)(!0,"clearPendingApppleTransaction - "),x(null);let e=localStorage.getItem("pendingAppleTransactions");(e=e?JSON.parse(e):{})[E]=null,e=JSON.stringify(e),localStorage.setItem("pendingAppleTransactions",e)},O=e=>{"ok"===e.status?(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleMessageHandler&&window.webkit.messageHandlers.toggleMessageHandler.postMessage({action:"finishTransaction"}),q(),k(!0)):(console.log("reportAnAppleTransactionCallback returns error, pending: ",b),v(e.error))},Z=t=>{(0,h.qu)(!0,"transactionWebCall",t);let s=t.transaction;"ok"===t.status?H(s):e.push("/services/payment"),n((0,m.Xz)(g.op.IOSInAppPurchase))};return(0,a.useEffect)(()=>{y&&N&&n((0,m.Pe)({checkoutPlan:N}))},[y,N]),(0,a.useEffect)(()=>{b&&((0,h.qu)(!0,"useEffect - pendingAppleTransaction: ",b),n((0,m.cK)({transaction:b,callback:O})))},[b]),(0,a.useEffect)(()=>{S&&(0,h.qu)(!0,"useEffect - reportAnAppleTransactionErrorn: ",S)},[S]),(0,a.useEffect)(()=>{(0,h.qu)(!0,"appleCientSecret: ",I),I&&(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleMessageHandler&&(console.log("checkout"),n((0,m.z8)(g.op.IOSInAppPurchase)),window.bsafesNative.transactionWebCall=Z,window.webkit.messageHandlers.toggleMessageHandler.postMessage({action:"checkout",planId:C,appleClientSecret:I})),n((0,m.GY)()))},[I]),(0,a.useEffect)(()=>{j&&((0,h.qu)(!0,"Apple transaction is completed."),e.push("/services/appleTransactionCompletion"))},[j]),(0,s.jsxs)(p.Z,{showNaveBar:!1,children:[(0,s.jsxs)(o.Z,{children:[(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(l.Z,{xs:{span:12},sm:{span:10,offset:1},md:{span:8,offset:2},lg:{span:6,offset:3},children:(0,s.jsx)("div",{style:{borderStyle:"solid"},className:"p-3",children:P&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Total Amount:"}),(0,s.jsx)("h4",{children:"$".concat((P.amount/100).toFixed(2)," ").concat(P.currency.toUpperCase())})]})})})}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(l.Z,{xs:{span:12},sm:{span:10,offset:1},md:{span:8,offset:2},lg:{span:6,offset:3},children:(0,s.jsx)("div",{style:{borderStyle:"solid"},className:"p-3",children:A&&t&&(0,s.jsx)(u.Elements,{stripe:t,options:{clientSecret:A},children:(0,s.jsx)(f,{})})})})}),(0,s.jsx)("br",{}),!1]}),(0,s.jsx)(d.Z,{setStripePromise:w})]})}}},function(e){e.O(0,[3937,8491,1011,2888,9774,179],function(){return e(e.s=87443)}),_N_E=e.O()}]);